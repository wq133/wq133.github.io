---
layout: post
title: 开发复盘（一）
subtitle: 开发日记1...
date: 2024-06-27
author: Wu
header-img: ../img/XK_1.jpg
tags:
  - 开发复盘
  - 需求设计
  - 安全问题
---

### 出现的问题：
0627-需求重写，设计思路混乱
0628-需求验证-分页总计统计-问题
### 反思：
1. 理解需求问题：看原型，实际是从门店和服务平台工单的维度来划分任务，任务来源task_source_ident 字段从任务活跃表划分门店任务和工单任务的区别。
2. 设计问题：设计新需求，需要了解，原型**涉及的数据库表**，以门店视图为例子，原型显示两个主页面，一个线上门店页面（以分公司维度划分），一个线下门店页面（以门店维度划分）
- 所以涉及到主表：ymd_org_table ？公司层级表、ymd_store_detail 门店详情表；
- 再分析每个页面关联的表，就是ymd_task 任务活跃表（统计分公司的任务状态数据、统计分公司任务数 展开列表、统计门店维度的 （线下）任务数、 统计柜员的相关状态｜忙碌、空闲、统计门店柜员数 展开列表的柜员拥有的任务状态）、ymd_user 门店用户表、ymd_store_user_detail_re 门店柜员表中间表（通过storeId关联统计门店所挂的柜员列表）；
3. 人性问题：趋利避害，缺乏耐心。诚然，来到一个新环境，领导性格偏直爽，有啥就骂（最近好点），我是一个infp的性格，感觉厦门的状态就是我能做到的极限，但是慢慢的我开始认为我能做好一些需求，实际现在看来**能做**和**做好**，差距还是很大的。做好就是把这件事让多个人都认同，并且达到的结果是个好的至少不能产生负面影响。能做就是勉强完成，中间有许多问题，会产生某些负面影响（对自己/他人/其他事物）。为了避免被骂，我选择啃代码，按自己的理解来写需求，设计文档按照之前的规格，第一版被骂了，过于粗糙，这件事让我开始反思，1是公司包容性的问题，2是开始怀疑以前的开发经验及逻辑，3进而对自己的能力感到质疑？4有些emo情绪（轻度）。现在复盘下来，就是说 我在开发流程上还是过于年轻，单独设计模块被质疑是否能做好，我现在的结论是 **能做**，那做好需要什么？
- 初期需求理解问题（沟通）、设计问题（设计原则、沟通）、人性问题（自我管理、技术提升、复盘总结、沟通技巧）、自己的标准（代码质量问题（需求正确理解、开发过程中的vo重写、还有代码注释、业务逻辑、性能问题考虑）、开发时间风险管理（潜在风险（开发文档的评估、功能开关控制、代码回滚｜sql回滚、代码质量把控（单测覆盖率、其他TODO））））
- 综上出现最多的点就是沟通，参考书籍： 《非暴力沟通》、《沟通的艺术》

设计
### 性能问题考虑
从前代码习惯太乱，做法比较狂野，直接全查，然后全量统计后，手动进行分页（由于某些查询条件不满足/sql能力差劲/偷懒｜考虑之前的性能问题和数据规模，员工量在3000+ 全量查询的都是toB数据，关联查询数据量，保守估计不会超过 2w，充其量就是慢，所以没出现特别大的问题）。

规范的开发流程是：应该先查到分页的主表数据（在满足查询条件的基础上，需要考虑主表查询数据的时候 **需要关联其他张表的数据量** 或者 **进行某个条件查询的子查询的数据量** ｜**回表问题**），然后再去写业务逻辑。

思考：现有业务量，全国工单数据量峰值每小时1w条任务 来计算，员工 10w左右（23年），50+分公司，2000+ 门店。保守 按一个分公司员工5000 人数据量人，按人均处理任务 50个工单任务左右，数据量在25w 级别。所以规范开发，分页对性能的优化很大且很有必要。（请求时间控制在400ms内）



### 设计层面考虑
- 先根据原型，确定要统计的主表和其他查询数据的表，再确定需求核心的数据的统计规则；
- 确定接口的定义，展示字段Vo设计，入参、查询条件的设计；
- 安全问题：是否涉及 水平越权、垂直越权、未授权登陆、xss攻击、短信轰炸
- 再去写伪代码逻辑，入参校验，鉴权控制（涉及水平鉴权控制｜公共、），其他特殊查询条件处理逻辑...
- 解决安全问题（水平越权（公司层级Code）、垂直越权（RBAC role base access control）、未授权登陆（强密码策略、双重验证（邮箱验证码、短信验证码、移动app生成的一次性密码等）、设置登录重试限制（避免字典重试攻击））、xss攻击、短信轰炸）
### 安全问题考虑｜TODO

#### 垂直鉴权


#### 水平鉴权


#### 未授权访问


#### xss攻击
#### 短信轰炸








